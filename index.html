<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Connect with Warpcast</title>
</head>
<body>
  <div id="app">
    <div id="status">Checking platform...</div>
    <button id="connectBtn" style="display:none;">Connect with Warpcast</button>
    <div id="address" style="margin-top:20px;"></div>
  </div>

  <!-- SDK –∏ Wagmi -->
  <script type="module">
    import sdk from 'https://esm.sh/@farcaster/frame-sdk';
    import { farcasterFrame } from 'https://esm.sh/@farcaster/frame-wagmi-connector';
    import {
      getAccount,
      watchAccount,
      connect,
      configureChains,
      createConfig,
} from 'https://unpkg.com/@wagmi/core@1.6.5?module';

    import { base } from 'https://unpkg.com/@wagmi/core/chains?module';
    import { publicProvider } from 'https://esm.sh/wagmi/providers/public';

    const connectBtn = document.getElementById("connectBtn");
    const status = document.getElementById("status");
    const addressDiv = document.getElementById("address");

    async function init() {
      try {
        await sdk.actions.ready({ disableNativeGestures: true });

        const context = await sdk.context;
        const isWarpcast = !!context.client;

        if (isWarpcast) {
          status.innerText = "‚úÖ Opened in Warpcast";
          connectBtn.style.display = "inline-block";

          const { publicClient } = configureChains([base], [publicProvider()]);

          const wagmiConfig = createConfig({
            autoConnect: true,
            connectors: [farcasterFrame()],
            publicClient,
          });

          connectBtn.addEventListener("click", async () => {
            try {
              await connect({ connector: farcasterFrame() });
              const account = getAccount();
              addressDiv.innerText = "Connected: " + account.address;
              connectBtn.style.display = "none";
            } catch (err) {
              console.error("Error connecting:", err);
            }
          });

          // Watch for account changes
          watchAccount((acc) => {
            if (acc.isConnected) {
              addressDiv.innerText = "Connected: " + acc.address;
              connectBtn.style.display = "none";
            }
          });
        } else {
          status.innerText = "üåê Not in Warpcast (open in browser)";
        }
      } catch (err) {
        status.innerText = "‚ùå Failed to initialize";
        console.error("Init error:", err);
      }
    }

    init();
  </script>
</body>
</html>
