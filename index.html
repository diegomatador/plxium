<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Frames v2 Demo (HTML + JS)</title>
  <script type="module">
    import sdk from 'https://esm.sh/@farcaster/frame-sdk';
    import { EthereumClient, w3mConnectors, w3mProvider, WagmiCore, WagmiCoreChains } from "https://unpkg.com/@web3modal/ethereum@2.7.1";
    import { Web3Modal } from "https://unpkg.com/@web3modal/html@2.6.2";

    const { base } = WagmiCoreChains;
    const {
      configureChains,
      createConfig,
      connect,
      disconnect,
      getAccount,
      watchAccount
    } = WagmiCore;

    const projectId = "4b8953ae3a579f498e15afac1101b481";// ← вставь свой WalletConnect Project ID
    const chains = [base];
    const { publicClient } = configureChains(chains, [w3mProvider({ projectId })]);

    const wagmiConfig = createConfig({
      autoConnect: true,
      connectors: w3mConnectors({ projectId, chains }),
      publicClient
    });

    const ethereumClient = new EthereumClient(wagmiConfig, chains);
    const modal = new Web3Modal({ projectId, themeMode: "light" }, ethereumClient);

    let context = null;
    let isSDKLoaded = false;

    async function init() {
      const statusEl = document.getElementById("status");
      const addressEl = document.getElementById("address");
      const connectBtn = document.getElementById("connect-btn");

      if (!isSDKLoaded) {
        try {
          context = await sdk.context;
          sdk.actions.ready();
          isSDKLoaded = true;
          console.log("SDK Loaded:", context);
        } catch (e) {
          console.warn("SDK not in Farcaster frame");
        }
      }

      function updateUI(address) {
        addressEl.textContent = address || "Not connected";
        connectBtn.textContent = address ? "Disconnect" : "Connect";
      }

      async function handleConnectDisconnect() {
        const acc = getAccount();
        if (acc?.address) {
          disconnect();
          updateUI(null);
        } else {
          await connect({ connector: wagmiConfig.connectors[0] });
          const newAcc = getAccount();
          updateUI(newAcc.address);
        }
      }

      // Set initial state
      const farcasterAddr = context?.connectedAddress;
      const walletAddr = getAccount()?.address;

      if (farcasterAddr) {
        updateUI(farcasterAddr);
      } else if (walletAddr) {
        updateUI(walletAddr);
      } else {
        updateUI(null);
      }

      connectBtn.onclick = handleConnectDisconnect;

      watchAccount((account) => {
        updateUI(account.address);
      });
    }

    window.addEventListener('DOMContentLoaded', init);
  </script>

  <style>
    body {
      font-family: sans-serif;
      max-width: 300px;
      margin: auto;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 16px;
      margin-top: 1rem;
    }
    .section {
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <h1>Frames v2 Demo</h1>
  <div class="section">
    <h2>Wallet</h2>
    <p><strong>Address:</strong> <span id="address">Loading...</span></p>
    <button id="connect-btn">Connect</button>
  </div>
</body>
</html>
